<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Session Summary - {{ session.session_id or 'unknown' }}</title>
    <style>
      body { font-family: Arial, sans-serif; color: #222; margin: 28px; }
      .cover { text-align: center; margin-top: 80px; }
      .title { font-size: 28px; font-weight: 700; }
      .meta { color: #666; margin-top: 6px; }
      .section { margin-top: 28px; }
      .two-col { display: flex; gap: 16px; }
      .col { flex: 1; }
      table { width: 100%; border-collapse: collapse; }
      th, td { text-align: left; padding: 6px 8px; }
      th { background: #f6f6f6; }
      .timeline { width: 100%; height: 200px; background: #fff; border: 1px solid #eee; display:flex; align-items:center; justify-content:center; }
      .thumbnail { max-width: 320px; border: 1px solid #ddd; }
    </style>
  </head>
  <body>
    <div class="cover">
      <div class="title">Session Summary</div>
      <div class="meta">Session: {{ session.session_id or 'unknown' }} â€” {{ session.timestamp or '' }}</div>
    </div>

    <div class="section two-col">
      <div class="col">
        <h3>Key summary</h3>
        <table>
          <tr><th>Overall truthfulness</th><td>{{ '%.2f'|format(session.fusion_score or 0.0) }}</td></tr>
          <tr><th>Face (score)</th><td>{{ session.modalities.face if session.modalities and session.modalities.face is defined else 'N/A' }}</td></tr>
          <tr><th>Voice (score)</th><td>{{ session.modalities.voice if session.modalities and session.modalities.voice is defined else 'N/A' }}</td></tr>
          <tr><th>Text (score)</th><td>{{ session.modalities.text if session.modalities and session.modalities.text is defined else 'N/A' }}</td></tr>
        </table>

        <h4 style="margin-top:12px">Top flagged moments</h4>
        <table>
          <tr><th>Time</th><th>Snippet</th><th>Risk</th></tr>
          {% for item in (session.top_moments or [])[:10] %}
            <tr>
              <td>{{ item.start }}</td>
              <td>{{ item.text }}</td>
              <td>{{ item.risk or '' }}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
      <div class="col">
        <h3>Timeline</h3>
        <div class="timeline">
          {% if session.timeline_png %}
            <img src="{{ session.timeline_png }}" alt="timeline" style="max-width:100%; max-height:180px;" />
          {% else %}
            [Timeline image will be inserted in high-fidelity version]
          {% endif %}
        </div>

        {% if session.thumbnail_url %}
        <h4 style="margin-top:12px">Thumbnail</h4>
        <img class="thumbnail" src="{{ session.thumbnail_url }}" alt="thumbnail" />
        {% endif %}

        {% if session.video_url %}
        <p style="font-size:12px;color:#666;margin-top:8px">Video (not embedded): {{ session.video_url }}</p>
        {% endif %}
      </div>
    </div>

    <div class="section">
      <h3>Transcript</h3>
      <table>
        <tr><th>Start</th><th>End</th><th>Text</th></tr>
        {% for seg in (session.transcript or []) %}
          <tr>
            <td>{{ seg.start }}</td>
            <td>{{ seg.end }}</td>
            <td>{{ seg.text }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>

    <div class="section">
      <h3>Metadata</h3>
      <pre style="font-size:11px; color:#444; background:#f9f9f9; padding:8px;">{{ session | tojson(indent=2) }}</pre>
    </div>
  </body>
</html>
